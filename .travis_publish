# #!/bin/bash
# PUBLICATION_BRANCH=gh-pages
# # Checkout the branch
# REPO_PATH=$PWD
# pushd $HOME
# git clone --branch=$PUBLICATION_BRANCH    https://${GITHUB_TOKEN}@github.com/$TRAVIS_REPO_SLUG publish 2>&1 > /dev/null
# cd publish
# # Update pages
# cp -r $REPO_PATH/$TRAVIS_TAG .
# # Commit and push latest version
# git add .
# git config user.name  "Travis"
# git config user.email "travis@travis-ci.org"
# git commit -m "Updated distribution."
# git push -fq origin $PUBLICATION_BRANCH 2>&1 > /dev/null
# popd



#!/bin/bash

set -e # exit with nonzero exit code if anything fails

echo "Starting to update gh-pages"

ls -la

echo "copy data we're interested in to other place"
cp -R build $HOME/build

#go to home and setup git
cd $HOME
git config --global user.email "travis@travis-ci.org"
git config --global user.name "Travis"

echo "Using token clone gh-pages branch"
git clone --quiet --branch=gh-pages https://${GITHUB_TOKEN}@github.com/embl-communications/embl-conceptual-pages.git gh-pages > /dev/null

#go into directory and copy data we're interested in to that directory
cd gh-pages
mkdir v1
cd v1
cp -Rf $HOME/build/* .

# echo "Allow files with underscore https://help.github.com/articles/files-that-start-with-an-underscore-are-missing/" > .nojekyll
# echo "[View live](https://${GH_USER}.github.io/${GH_REPO}/)" > README.md

#add, commit and push files
git add -f .
git commit -m "Travis build $TRAVIS_BUILD_NUMBER"
git push -fq origin gh-pages > /dev/null

echo "Done updating gh-pages"

